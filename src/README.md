# Документация к системе рекомендаций и аналитики

## Архитектура системы и взаимодействие между микросервисами

### Архитектура системы

Система состоит из нескольких микросервисов, каждый из которых выполняет определенные функции. Основные компоненты системы:

1. **User Service**: Отвечает за управление пользователями, включая регистрацию, аутентификацию и обновление профиля. Аутентификация реализована с помощью JWT.
2. **Product Service**: Управляет продуктами, включая создание, обновление, удаление и получение информации о продуктах.
**Recommendation Service**: Генерирует рекомендации для пользователей на основе их предпочтений и истории лайков. В моей реализации рекомендации выстраиваются по следующему принципу:
   - Если у пользователя еще нет лайков, то рекомендуются ТОП 3 продукта по количеству лайков в системе.
   - Если у пользователя есть лайк на продукте, на странице которого он находится, то ему будут показываться ТОП 3 продукта по лайкам в этой категории.
   - Если в категории меньше 3 продуктов, то будут показываться те, что есть, плюс самые залайканные продукты в системе в целом.
4. **Analytics Service**: Собирает данные о действиях пользователей и продуктах, сохраняет их в БД. Для последующего анализа.
5. **Kafka**: Используется для асинхронного взаимодействия между микросервисами. Есть два топика: user_updates и product_updates.
6. **PostgreSQL**: База данных для хранения информации о пользователях, продуктах и рекомендациях. У каждого микросервиса своя база данных, но хранятся они в одном контейнере.
7. **Redis**: Кэш для хранения часто запрашиваемых данных. В моей реализации кэшируются рекомендации. Если рекомендация для пользователя к определенному товару запрашивается больше 5 раз, то она заносится в кэш и в последующие разы подгружается оттуда.
8. **Nginx**: Обратный прокси-сервер для маршрутизации запросов к соответствующим микросервисам.

### Взаимодействие между микросервисами

1. **User Service**:
   - Взаимодействует с Kafka для отправки сообщений о действиях пользователей (регистрация, обновление профиля).
   - Взаимодействует с PostgreSQL для хранения информации о пользователях.

2. **Product Service**:
   - Взаимодействует с Kafka для отправки сообщений о действиях с продуктами (создание, обновление, удаление, лайки).
   - Взаимодействует с PostgreSQL для хранения информации о продуктах.

3. **Recommendation Service**:
   - Взаимодействует с Kafka для получения сообщений о действиях пользователей и продуктов.
   - Взаимодействует с PostgreSQL для хранения и получения рекомендаций.
   - Взаимодействует с Redis для кэширования рекомендаций.

4. **Analytics Service**:
   - Взаимодействует с Kafka для получения сообщений о действиях пользователей и продуктов.
   - Взаимодействует с PostgreSQL для хранения аналитических данных.

5. **Kafka**:
   - Обеспечивает асинхронное взаимодействие между микросервисами.
   - Используется для отправки и получения сообщений о действиях пользователей и продуктов.

6. **PostgreSQL**:
   - Хранит информацию о пользователях, продуктах и рекомендациях.

7. **Redis**:
   - Кэширует часто запрашиваемые данные для ускорения доступа.

8. **Nginx**:
   - Маршрутизирует входящие запросы к соответствующим микросервисам.

## Использованные технологии и их настройки

### Технологии

1. **Go**: Язык программирования для написания микросервисов.
2. **Kafka**: Система для асинхронного взаимодействия между микросервисами.
3. **PostgreSQL**: Реляционная база данных для хранения информации.
4. **Redis**: Кэш для хранения часто запрашиваемых данных.
5. **Nginx**: Обратный прокси-сервер для маршрутизации запросов.
6. **Docker**: Контейнеризация микросервисов для упрощения развертывания и управления.
7. **JWT**: JSON Web Tokens для аутентификации пользователей.

### Настройки

1. **Kafka**:
   - **Broker**: `kafka:9092`
   - **Topics**: `user_updates`, `product_updates`

2. **PostgreSQL**:
   - **User**: `postgres`
   - **Password**: `1`
   - **Databases**: `users_db`, `products_db`, `recommends_db`, `analytics_db`

3. **Redis**:
   - **URL**: `redis:6379`

4. **JWT**:
   - **Secret Key**: `secret`

5. **Креды для админа**
    - **email** : `admin@site.com`
    - **password** : `pass`

## Инструкции по запуску

### Предварительные требования

1. Установите Docker и Docker Compose.
2. Убедитесь, что у вас есть доступ к интернету для загрузки Docker-образов.

### Шаги по запуску

1. **Клонируйте репозиторий**:
   ```sh
   git clone <repository_url>
   cd <repository_directory>
   ```

2. **Соберите и запустите контейнеры**:
   ```sh
   docker-compose up --build -d
   ```

3. **Проверьте состояние контейнеров**:
   ```sh
   docker-compose ps
   ```

4. **Доступ к сервисам**:
   - **Заглавная страница**: `http://localhost:8080`
   - **User Service**: `http://localhost:9999`
   - **Product Service**: `http://localhost:7777`
   - **Recommendation Service**: `http://localhost:6666`
   - **Analytics Service**: `http://localhost:5555`


### Завершение работы

Для остановки и удаления контейнеров выполните команду:
```sh
docker-compose down
```

Эта документация охватывает основные аспекты архитектуры системы, взаимодействие между микросервисами, использованные технологии и инструкции по запуску.